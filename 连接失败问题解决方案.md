# 🔧 WebSocket连接失败问题解决方案

## 📋 问题描述

当你点击手语练习按钮时，没有任何反馈，并显示"连接失败"。

## 🔍 问题原因

最可能的原因是：**Python环境缺少必要的依赖包**

后端服务在启动时会尝试运行Python脚本 `realtime_recognition_with_scoring.py`，这个脚本需要以下依赖：
- `mediapipe` - 手部追踪
- `opencv-python` - 图像处理
- `numpy` - 数值计算
- `joblib` - 模型加载
- `scikit-learn` - 机器学习
- `pandas` - 数据处理

如果这些包没有安装，Python进程会启动失败，导致WebSocket无法工作。

## ✅ 解决步骤

### 方案1：一键安装（推荐）

1. **双击运行**：`一键安装依赖.bat`
2. **等待安装完成**（可能需要几分钟）
3. **运行服务器**：`RUN_SERVER.bat`
4. **测试系统**：打开浏览器访问 http://localhost:4000

### 方案2：检查并修复

1. **双击运行**：`检查Python依赖.bat`
2. **查看检查结果**
3. **如果发现缺失依赖，按提示安装**
4. **运行服务器**：`RUN_SERVER.bat`

### 方案3：手动安装

如果自动安装失败，可以手动执行：

```bash
# 1. 安装Python依赖
pip install mediapipe opencv-python numpy joblib scikit-learn pandas

# 2. 安装Node.js依赖
npm install

# 3. 训练AI模型（如果还没有）
cd server/ml
python AIModelTrain.py
cd ../..

# 4. 启动服务器
npm run backend
```

## 🎯 验证系统是否正常

### 1. 检查Python依赖

打开命令行，运行：
```bash
python -c "import mediapipe, cv2, numpy, joblib, sklearn, pandas; print('✅ 所有依赖已安装')"
```

如果看到 `✅ 所有依赖已安装`，说明Python环境正常。

### 2. 检查AI模型

确认文件存在：`server\ml\asl_knn_model.pkl`

### 3. 检查WebSocket连接

1. 启动服务器（`RUN_SERVER.bat`）
2. 打开浏览器访问 http://localhost:4000
3. 进入 Webcam 页面
4. 点击"启动相机"
5. 查看页面上的连接状态：
   - **✅ 已连接** = 正常
   - **🔄 连接中...** = WebSocket未连接

## 🐛 常见问题

### Q1: pip install 很慢怎么办？

使用国内镜像源加速：
```bash
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple mediapipe opencv-python numpy joblib scikit-learn pandas
```

### Q2: 提示"Python未安装"？

1. 下载Python：https://www.python.org/downloads/
2. 安装时**务必勾选 "Add Python to PATH"**
3. 重新打开命令行窗口
4. 运行 `python --version` 验证

### Q3: 后端启动但前端还是无法连接？

1. 检查后端日志中是否有 Python 错误信息
2. 确认端口4000没有被其他程序占用
3. 重启浏览器，清除缓存
4. 检查防火墙设置

### Q4: 模型训练失败？

1. 确认 `server/ml/asl_dataset.csv` 文件存在
2. 确认所有Python依赖已安装
3. 手动运行训练脚本查看详细错误：
```bash
cd server/ml
python AIModelTrain.py
```

## 📊 系统架构说明

```
用户浏览器 (http://localhost:4000)
    ↓ WebSocket连接
Node.js后端 (server/index.ts)
    ↓ 启动Python进程
Python AI服务 (realtime_recognition_with_scoring.py)
    ↓ 加载模型
AI模型文件 (asl_knn_model.pkl)
```

只要这个链条的任何一环出问题，都会导致连接失败。

## 🎓 AI模型说明

- **训练数据**：`server/ml/asl_dataset.csv` （376个手语样本）
- **训练算法**：KNN (K近邻算法)
- **模型文件**：`server/ml/asl_knn_model.pkl`
- **准确率**：约73%
- **支持手势**：A, B, C, D, E 等字母手语

模型文件必须存在才能进行手势识别。如果不存在，启动脚本会自动训练。

## 💡 下一步

安装完依赖后：

1. ✅ 运行 `RUN_SERVER.bat`
2. ✅ 浏览器打开 http://localhost:4000
3. ✅ 点击 "Webcam" 菜单
4. ✅ 点击 "启动相机"（允许浏览器访问摄像头）
5. ✅ 选择手势 A、B、C、D 或 E
6. ✅ 对着摄像头做手势，查看AI识别结果！

---

**如果问题仍未解决，请提供以下信息：**
- `检查Python依赖.bat` 的运行结果
- 后端启动时的控制台输出
- 浏览器控制台的错误信息（按F12打开）

