# 修复白屏 - 重启指南

## 🚨 问题症状
- ✅ 已修复导入问题（LETTERS 导出错误）
- ✅ 已配置 Vite strictPort 和 HMR
- ✅ 已优化 dev 脚本

---

## 🔧 清理和重启步骤

### 步骤 1: 停止所有 Node 进程

**Windows (PowerShell)**:
```powershell
# 查看所有 node 进程
tasklist | findstr node

# 停止所有 node 进程
taskkill /F /IM node.exe
```

### 步骤 2: 清理 Vite 缓存

```bash
# 在 GestureWorkshop 目录下执行
rmdir /S /Q node_modules\.vite
```

或者使用强制清理启动：
```bash
npm run dev -- --force
```

### 步骤 3: 重启开发服务器

```bash
npm run dev
```

**预期输出**:
```
[client] VITE v5.x.x  ready in xxx ms
[client] 
[client]   ➜  Local:   http://localhost:5173/
[client]   ➜  Network: use --host to expose
[client]
[server] ✅ Server running on http://localhost:4000
[server] 🔗 Attaching Gesture WebSocket...
```

### 步骤 4: 浏览器强制刷新

1. 打开 `http://localhost:5173`
2. 按 `Ctrl + Shift + R` (Windows) / `Cmd + Shift + R` (Mac) 强制刷新

---

## ✅ 验收标准

### 1. 终端显示正常
- ✅ `[client]` 和 `[server]` 都有输出
- ✅ 没有 exit code 1 错误
- ✅ 端口 5173 和 4000 都已启动

### 2. 浏览器加载正常
- ✅ 页面不再白屏
- ✅ 控制台无 `LETTERS` export 错误
- ✅ 控制台无 `ERR_CONNECTION_REFUSED` 错误
- ✅ HMR 正常工作（修改文件后自动刷新）

### 3. 功能测试
- ✅ 点击 "Start Camera" 可以打开摄像头
- ✅ 选择手势后点击 "Start Recognition" 开始识别
- ✅ 按 `D` 键可以切换 Debug 面板

---

## 🐛 如果仍然出现问题

### 问题 1: 端口被占用
**错误**: `Port 5173 is in use`

**解决**:
```powershell
# 查找占用 5173 端口的进程
netstat -ano | findstr :5173

# 停止该进程（替换 <PID> 为实际进程ID）
taskkill /F /PID <PID>
```

### 问题 2: LETTERS 仍然报错
**解决**:
1. 确认 `client/src/hooks/useSpellingCoach.ts` 第 18 行有：
   ```typescript
   export const LETTERS = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
   ```

2. 清理浏览器缓存:
   - 按 `F12` 打开开发者工具
   - 右键刷新按钮 → 选择 "清空缓存并硬性重新加载"

### 问题 3: WebSocket 连接失败
**错误**: `[WS] ⚠️ Error` 或 `❌ Closed`

**检查**:
1. 后端是否启动 (应该看到 `[server]` 日志)
2. 端口 4000 是否被占用
3. Python 环境是否正常 (应该看到 `🐍 Starting Python`)

---

## 📊 改动总结

### 修改的文件:
1. ✅ `client/src/components/WebcamViewer.tsx` - 改为相对路径导入
2. ✅ `client/src/components/WebcamOverlay.tsx` - 改为相对路径导入
3. ✅ `client/src/hooks/useGestureScore.ts` - 改为相对路径导入
4. ✅ `package.json` - 优化 dev 脚本 (strictPort + concurrently)
5. ✅ `vite.config.ts` - 添加 strictPort 和 HMR 配置
6. ✅ `client/public/favicon.ico` - 创建空文件避免 404

### 为什么改为相对路径?
- Vite HMR 在某些情况下对 `@` 别名解析会有缓存问题
- 相对路径更稳定，避免模块解析错误
- 生产构建时会自动优化，不影响性能

---

## 🎯 下一步

修复成功后，您可以：
1. 按 `D` 键打开 Debug 面板
2. 验证性能优化效果（延迟、FPS 等）
3. 参考 `性能优化说明.md` 进一步调优

---

**最后更新**: 2025-01-17  
**问题来源**: Vite HMR 模块解析 + 导出缓存



